"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[150],{56947:(e,t,r)=>{r.d(t,{A:()=>N});var o=r(95155),n=r(12115),l=r(34606),s=r.n(l),a=r(90947),i=r(48553),c=r(78770),d=r(92033),u=r(32265),g=r(78503),p=r(74955),b=r(88955),x=r(35831),m=r(12158),h=r(21033),f=r(27916),y=r(13630),v=r(26541),w=r(69795),j=r(70944);let N=(0,n.forwardRef)((e,t)=>{let{className:r="",isWizard:l=!1,onAreaSelected:N,onLocationChange:k,initialGeoJSON:C=null}=e,L=(0,n.useRef)(null),S=(0,n.useRef)(null),[A,D]=(0,n.useState)(!1),[P,E]=(0,n.useState)(!1),[F,M]=(0,n.useState)("hand"),z=(0,n.useRef)("hand"),[G,R]=(0,n.useState)([]),T=(0,n.useRef)([]),W=(0,n.useRef)([]),[I,O]=(0,n.useState)(null),[_,B]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(z.current=F,S.current&&A){let e=S.current.getCanvas(),t=S.current;console.log("Tool changed to:",F),"hand"===F?(e.style.cursor="",t.dragPan&&(t.dragPan.enable(),console.log("DragPan enabled"))):("box"===F||"polygon"===F)&&(e.style.cursor="crosshair",t.dragPan&&(t.dragPan.disable(),console.log("DragPan disabled for",F)))}},[F,A]);let U=()=>{if(W.current.length>1){W.current.pop();let e=W.current[W.current.length-1];if(T.current=[...e],R([...e]),S.current){let t=S.current.getSource("aoi-results");if(e.length>=3){let r=[...e,e[0]];t.setData({type:"Feature",geometry:{type:"Polygon",coordinates:[r]},properties:{}})}else 2===e.length?t.setData({type:"Feature",geometry:{type:"LineString",coordinates:e},properties:{}}):t.setData({type:"FeatureCollection",features:[]})}}};return((0,n.useEffect)(()=>{let e=e=>{(e.ctrlKey||e.metaKey)&&"z"===e.key&&"polygon"===z.current&&G.length>0&&(e.preventDefault(),U())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[G]),(0,n.useEffect)(()=>{if(L.current)return(()=>{try{let e=document.createElement("canvas");if(!(e.getContext("webgl")||e.getContext("experimental-webgl")))throw Error("WebGL not supported");S.current=new(s()).Map({container:L.current,style:{version:8,sources:{streets:{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"Esri"}},layers:[{id:"streets-layer",type:"raster",source:"streets",minzoom:0,maxzoom:19}]},center:[-74.006,40.7128],zoom:12,pitch:0,bearing:0,doubleClickZoom:!1}),S.current.on("load",()=>{if(D(!0),!S.current)return;if(S.current.addSource("aoi-results",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),S.current.addLayer({id:"aoi-fill",type:"fill",source:"aoi-results",paint:{"fill-color":"#6366f1","fill-opacity":.2}}),S.current.addLayer({id:"aoi-outline",type:"line",source:"aoi-results",paint:{"line-color":"#4f46e5","line-width":2}}),!l&&C){let e=S.current.getSource("aoi-results");if(e){e.setData(C);let t=new(s()).LngLatBounds;"Polygon"===C.geometry.type&&(C.geometry.coordinates[0].forEach(e=>{t.extend(e)}),S.current.fitBounds(t,{padding:20,duration:0}))}}let e=null,t=!1;S.current.on("mousedown",r=>{console.log("Mouse down event fired, current tool:",z.current),"box"===z.current&&(console.log("Starting box draw at:",r.lngLat),t=!0,e=[r.lngLat.lng,r.lngLat.lat],S.current.getCanvas().style.cursor="crosshair")}),S.current.on("mousemove",r=>{if(t&&e&&"box"===z.current){let t=[r.lngLat.lng,r.lngLat.lat],o=[[e[0],e[1]],[t[0],e[1]],[t[0],t[1]],[e[0],t[1]],[e[0],e[1]]];S.current.getSource("aoi-results").setData({type:"Feature",geometry:{type:"Polygon",coordinates:[o]},properties:{}})}}),S.current.on("mouseup",r=>{if(t&&e&&"box"===z.current){t=!1;let o=[r.lngLat.lng,r.lngLat.lat],n=[[e[0],e[1]],[o[0],e[1]],[o[0],o[1]],[e[0],o[1]],[e[0],e[1]]],s={type:"Feature",geometry:{type:"Polygon",coordinates:[n]},properties:{}};if(S.current.getSource("aoi-results").setData(s),l&&N){let e=a.W(s)/1e6;O(s),N(Math.round(100*e)/100,s)}S.current.getCanvas().style.cursor="",e=null}}),S.current.on("click",e=>{if(console.log("Click event fired, current tool:",z.current),"polygon"===z.current){console.log("Adding polygon vertex at:",e.lngLat);let t=[e.lngLat.lng,e.lngLat.lat];T.current.push(t),R([...T.current]);let r=S.current.getSource("polygon-temp");if(r)if(T.current.length>=2){let e={type:"Feature",geometry:{type:"LineString",coordinates:T.current},properties:{}};r.setData(e)}else r.setData({type:"FeatureCollection",features:[]});if(W.current.push([...T.current]),T.current.length>=3){let e=[...T.current,T.current[0]],t=S.current.getSource("aoi-results");t&&t.setData({type:"Feature",geometry:{type:"Polygon",coordinates:[e]},properties:{}})}}}),S.current.on("dblclick",e=>{if("polygon"===z.current&&T.current.length>=3){e.preventDefault();let t=[...T.current,T.current[0]],r={type:"Feature",geometry:{type:"Polygon",coordinates:[t]},properties:{}};if(S.current.getSource("aoi-results").setData(r),l&&N){let e=a.W(r)/1e6;O(r),N(Math.round(100*e)/100,r)}T.current=[],W.current=[],R([]),S.current.getCanvas().style.cursor=""}})}),S.current.on("error",e=>{var t,r,o,n;console.error("MapLibre internal error:",e),((null==(r=e.error)||null==(t=r.message)?void 0:t.includes("webgl"))||(null==(n=e.error)||null==(o=n.message)?void 0:o.includes("Location")))&&E(!0)})}catch(e){console.warn("Map initialization failed, switching to Simulation Mode:",e.message),E(!0)}})(),()=>{S.current&&(S.current.remove(),S.current=null)}},[l]),(0,n.useEffect)(()=>{if(!l&&C&&S.current&&A){console.log("Loading initialGeoJSON:",C);let e=S.current.getSource("aoi-results");if(e){e.setData(C),O(C);try{let e=i.Q(C);S.current.fitBounds([e[0],e[1],e[2],e[3]],{padding:50,duration:1e3}),console.log("GeoJSON loaded and map fitted to bounds")}catch(e){console.error("Error fitting bounds:",e)}}else console.error("AOI source not found")}},[C,l,A]),(0,n.useImperativeHandle)(t,()=>({flyTo:(e,t,r)=>{S.current&&(r?S.current.fitBounds([r[0],r[1],r[2],r[3]],{padding:50,duration:1e3}):S.current.flyTo({center:[t,e],zoom:12,duration:1e3}),k&&k(e,t))},loadGeoJSON:e=>{let t;if(!S.current)return;let r=S.current.getSource("aoi-results");if(!r)return;if("FeatureCollection"===e.type){let r=e.features.find(e=>e.geometry&&["Polygon","MultiPolygon"].includes(e.geometry.type));if(!r)return;t=r}else t=e;r.setData(t),O(t);let o=a.W(t)/1e6;N&&N(Math.round(100*o)/100,t);let n=i.Q(t);S.current.fitBounds([n[0],n[1],n[2],n[3]],{padding:50,duration:1e3})},clearAOI:()=>{if(!S.current)return;let e=S.current.getSource("aoi-results");e&&e.setData({type:"FeatureCollection",features:[]}),O(null),R([]),N&&N(0)}})),P)?(0,o.jsx)("div",{className:"relative bg-slate-50 overflow-hidden ".concat(r," flex items-center justify-center"),children:(0,o.jsxs)("div",{className:"max-w-md mx-auto text-center p-8 space-y-4",children:[(0,o.jsx)("div",{className:"w-16 h-16 bg-rose-100 rounded-full flex items-center justify-center mx-auto",children:(0,o.jsx)(c.A,{className:"w-8 h-8 text-rose-600"})}),(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)("h3",{className:"text-lg font-bold text-slate-900",children:"Map Unavailable"}),(0,o.jsx)("p",{className:"text-sm text-slate-600 leading-relaxed",children:"Unable to initialize the interactive map. This may be due to WebGL not being supported or enabled in your browser."})]}),(0,o.jsxs)("div",{className:"bg-slate-100 rounded-lg p-4 text-left space-y-2",children:[(0,o.jsx)("p",{className:"text-xs font-bold text-slate-700",children:"Troubleshooting:"}),(0,o.jsxs)("ul",{className:"text-xs text-slate-600 space-y-1 list-disc list-inside",children:[(0,o.jsx)("li",{children:"Ensure WebGL is enabled in your browser settings"}),(0,o.jsx)("li",{children:"Update your graphics drivers"}),(0,o.jsx)("li",{children:"Try a different browser (Chrome, Firefox, or Edge)"}),(0,o.jsx)("li",{children:"Disable hardware acceleration and re-enable it"})]})]}),(0,o.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors",children:"Reload Page"})]})}):(0,o.jsxs)("div",{className:"relative bg-slate-50 overflow-hidden group ".concat(r," flex items-center justify-center"),children:[!A&&(0,o.jsxs)("div",{className:"flex flex-col items-center gap-3 text-slate-400 z-20",children:[(0,o.jsx)(d.A,{className:"w-8 h-8 animate-spin"}),(0,o.jsx)("span",{className:"text-xs font-medium uppercase tracking-widest",children:"Loading Map Engine..."})]}),(0,o.jsx)("div",{ref:L,className:"absolute inset-0 w-full h-full transition-opacity duration-700 ".concat(A?"opacity-100":"opacity-0")}),A&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"absolute right-4 top-4 space-y-2 z-10",children:[(0,o.jsxs)("div",{className:"bg-white/95 backdrop-blur rounded-lg border border-slate-200 shadow-lg overflow-hidden flex flex-col",children:[(0,o.jsx)("button",{onClick:()=>{var e;return null==(e=S.current)?void 0:e.zoomIn()},className:"p-2 hover:bg-slate-100 border-b border-slate-100",children:(0,o.jsx)(u.A,{className:"w-4 h-4 text-slate-600"})}),(0,o.jsx)("button",{onClick:()=>{var e;return null==(e=S.current)?void 0:e.zoomOut()},className:"p-2 hover:bg-slate-100",children:(0,o.jsx)(g.A,{className:"w-4 h-4 text-slate-600"})})]}),(0,o.jsx)("button",{onClick:()=>{var e;return null==(e=S.current)?void 0:e.resetNorthPitch()},className:"p-2 bg-white/95 backdrop-blur rounded-lg border border-slate-200 shadow-lg hover:bg-slate-100 transition-colors",children:(0,o.jsx)(p.A,{className:"w-4 h-4 text-slate-600"})}),(0,o.jsx)("button",{onClick:()=>{S.current&&(B(!0),"geolocation"in navigator?navigator.geolocation.getCurrentPosition(e=>{let{latitude:t,longitude:r}=e.coords;if(S.current){S.current.flyTo({center:[r,t],zoom:14,duration:1500});let e=new(s()).Marker({color:"#6366f1"}).setLngLat([r,t]).addTo(S.current);setTimeout(()=>e.remove(),3e3)}B(!1)},e=>{console.error("Geolocation error:",e),alert("Unable to get your location. Please check your browser permissions."),B(!1)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):(alert("Geolocation is not supported by your browser."),B(!1)))},disabled:_,className:"p-2 bg-white/95 backdrop-blur rounded-lg border border-slate-200 shadow-lg hover:bg-slate-100 transition-colors disabled:opacity-50",title:"Find My Location",children:_?(0,o.jsx)(d.A,{className:"w-4 h-4 text-indigo-600 animate-spin"}):(0,o.jsx)(b.A,{className:"w-4 h-4 text-slate-600"})})]}),(0,o.jsx)("div",{className:"absolute left-4 top-4 z-10",children:(0,o.jsxs)("div",{className:"bg-white/95 backdrop-blur rounded-lg border border-slate-200 shadow-lg flex flex-col p-1",children:[(0,o.jsx)("button",{onClick:()=>M("hand"),className:"p-2 rounded-md transition-colors ".concat("hand"===F?"bg-indigo-50 text-indigo-600":"hover:bg-slate-100 text-slate-600"),title:"Pan & Zoom",children:(0,o.jsx)(x.A,{className:"w-4 h-4"})}),l&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{onClick:()=>M("box"),className:"p-2 rounded-md transition-colors ".concat("box"===F?"bg-indigo-50 text-indigo-600":"hover:bg-slate-100 text-slate-600"),title:"Draw Rectangle",children:(0,o.jsx)(m.A,{className:"w-4 h-4"})}),(0,o.jsx)("button",{onClick:()=>M("polygon"),className:"p-2 rounded-md transition-colors ".concat("polygon"===F?"bg-indigo-50 text-indigo-600":"hover:bg-slate-100 text-slate-600"),title:"Draw Polygon",children:(0,o.jsx)(h.A,{className:"w-4 h-4"})}),G.length>0&&"polygon"===F&&(0,o.jsx)("button",{onClick:U,className:"p-2 rounded-md hover:bg-amber-50 text-amber-600 transition-colors",title:"Undo Last Point (Ctrl+Z)",children:(0,o.jsx)(f.A,{className:"w-4 h-4"})}),(I||G.length>0)&&(0,o.jsx)("button",{onClick:()=>{var e;let t=null==(e=S.current)?void 0:e.getSource("aoi-results");t&&t.setData({type:"FeatureCollection",features:[]}),O(null),R([]),T.current=[],W.current=[],M("hand"),N&&N(0)},className:"p-2 rounded-md hover:bg-rose-50 text-rose-600 transition-colors border-t border-slate-200",title:"Clear AOI",children:(0,o.jsx)(y.A,{className:"w-4 h-4"})})]})]})}),(0,o.jsxs)("div",{className:"absolute bottom-4 left-4 right-4 flex justify-between items-end pointer-events-none z-10",children:[(0,o.jsxs)("div",{className:"bg-slate-900/85 backdrop-blur text-white px-3 py-1.5 rounded-lg text-[10px] font-medium pointer-events-auto flex items-center gap-2",children:[(0,o.jsx)(v.A,{className:"w-3 h-3 text-indigo-400"}),"MapLibre GL Engine | ESRI World Street Map"]}),(0,o.jsxs)("div",{className:"flex gap-2 pointer-events-auto",children:[(0,o.jsxs)("button",{className:"bg-white/95 backdrop-blur px-3 py-2 rounded-lg border border-slate-200 shadow-lg flex items-center gap-2 text-xs font-medium text-slate-700 hover:bg-slate-100",children:[(0,o.jsx)(w.A,{className:"w-4 h-4"})," Layers"]}),(0,o.jsx)("button",{className:"bg-white/95 backdrop-blur p-2 rounded-lg border border-slate-200 shadow-lg flex items-center justify-center hover:bg-slate-100",children:(0,o.jsx)(j.A,{className:"w-4 h-4 text-slate-600"})})]})]})]})]})})},75768:(e,t,r)=>{r.d(t,{$n:()=>l,Ex:()=>a,Zp:()=>n,ke:()=>i,pd:()=>s});var o=r(95155);r(12115);let n=e=>{let{children:t,className:r="",onClick:n}=e;return(0,o.jsx)("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden ".concat(r),onClick:n,children:t})},l=e=>{let{children:t,variant:r="primary",size:n="md",onClick:l,className:s="",disabled:a=!1}=e;return(0,o.jsx)("button",{disabled:a,onClick:l,className:"".concat("inline-flex items-center justify-center font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none rounded-lg"," ").concat({primary:"bg-slate-900 text-white hover:bg-slate-800",secondary:"bg-slate-100 text-slate-900 hover:bg-slate-200",outline:"bg-transparent border border-slate-200 text-slate-900 hover:bg-slate-50",ghost:"bg-transparent text-slate-600 hover:bg-slate-100",danger:"bg-red-500 text-white hover:bg-red-600"}[r]," ").concat({sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[n]," ").concat(s),children:t})},s=e=>{let{label:t,type:r="text",placeholder:n,value:l,onChange:s,disabled:a=!1,className:i=""}=e;return(0,o.jsxs)("div",{className:"space-y-1.5 ".concat(i),children:[t&&(0,o.jsx)("label",{className:"text-sm font-medium text-slate-700",children:t}),(0,o.jsx)("input",{type:r,placeholder:n,value:l,onChange:s,disabled:a,className:"flex h-10 w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-slate-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"})]})},a=e=>{let{children:t,variant:r="neutral"}=e;return(0,o.jsx)("span",{className:"px-2 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wider ".concat({neutral:"bg-slate-100 text-slate-800",success:"bg-emerald-100 text-emerald-800",warning:"bg-amber-100 text-amber-800",danger:"bg-rose-100 text-rose-800",info:"bg-blue-100 text-blue-800"}[r]),children:t})},i=e=>{let{value:t,className:r=""}=e;return(0,o.jsx)("div",{className:"w-full bg-slate-100 rounded-full h-2 overflow-hidden ".concat(r),children:(0,o.jsx)("div",{className:"bg-indigo-600 h-full transition-all duration-500 ease-out",style:{width:"".concat(t,"%")}})})}}}]);