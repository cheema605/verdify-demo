"use strict";exports.id=746,exports.ids=[746],exports.modules={21365:(a,b,c)=>{c.d(b,{A:()=>x});var d=c(21124),e=c(38301),f=c(23820),g=c.n(f),h=c(88711),i=c(96857),j=c(74416),k=c(49113),l=c(55175),m=c(81295),n=c(39249),o=c(6763),p=c(15279),q=c(9738),r=c(22835),s=c(22306),t=c(40822),u=c(72133),v=c(8929),w=c(81190);let x=(0,e.forwardRef)(({className:a="",isWizard:b=!1,onAreaSelected:c,onLocationChange:f,initialGeoJSON:x=null},y)=>{let z=(0,e.useRef)(null),A=(0,e.useRef)(null),[B,C]=(0,e.useState)(!1),[D,E]=(0,e.useState)(!1),[F,G]=(0,e.useState)("hand"),H=(0,e.useRef)("hand"),[I,J]=(0,e.useState)([]),K=(0,e.useRef)([]),L=(0,e.useRef)([]),[M,N]=(0,e.useState)(null),[O,P]=(0,e.useState)(!1);(0,e.useEffect)(()=>{if(H.current=F,A.current&&B){let a=A.current.getCanvas(),b=A.current;console.log("Tool changed to:",F),"hand"===F?(a.style.cursor="",b.dragPan&&(b.dragPan.enable(),console.log("DragPan enabled"))):("box"===F||"polygon"===F)&&(a.style.cursor="crosshair",b.dragPan&&(b.dragPan.disable(),console.log("DragPan disabled for",F)))}},[F,B]);let Q=()=>{if(L.current.length>1){L.current.pop();let a=L.current[L.current.length-1];if(K.current=[...a],J([...a]),A.current){let b=A.current.getSource("aoi-results");if(a.length>=3){let c=[...a,a[0]];b.setData({type:"Feature",geometry:{type:"Polygon",coordinates:[c]},properties:{}})}else 2===a.length?b.setData({type:"Feature",geometry:{type:"LineString",coordinates:a},properties:{}}):b.setData({type:"FeatureCollection",features:[]})}}};return((0,e.useEffect)(()=>{let a=a=>{(a.ctrlKey||a.metaKey)&&"z"===a.key&&"polygon"===H.current&&I.length>0&&(a.preventDefault(),Q())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[I]),(0,e.useEffect)(()=>{if(z.current)return(()=>{try{let a=document.createElement("canvas");if(!(a.getContext("webgl")||a.getContext("experimental-webgl")))throw Error("WebGL not supported");A.current=new(g()).Map({container:z.current,style:{version:8,sources:{streets:{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"Esri"}},layers:[{id:"streets-layer",type:"raster",source:"streets",minzoom:0,maxzoom:19}]},center:[-74.006,40.7128],zoom:12,pitch:0,bearing:0,doubleClickZoom:!1}),A.current.on("load",()=>{if(C(!0),!A.current)return;if(A.current.addSource("aoi-results",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),A.current.addLayer({id:"aoi-fill",type:"fill",source:"aoi-results",paint:{"fill-color":"#6366f1","fill-opacity":.2}}),A.current.addLayer({id:"aoi-outline",type:"line",source:"aoi-results",paint:{"line-color":"#4f46e5","line-width":2}}),!b&&x){let a=A.current.getSource("aoi-results");if(a){a.setData(x);let b=new(g()).LngLatBounds;"Polygon"===x.geometry.type&&(x.geometry.coordinates[0].forEach(a=>{b.extend(a)}),A.current.fitBounds(b,{padding:20,duration:0}))}}let a=null,d=!1;A.current.on("mousedown",b=>{console.log("Mouse down event fired, current tool:",H.current),"box"===H.current&&(console.log("Starting box draw at:",b.lngLat),d=!0,a=[b.lngLat.lng,b.lngLat.lat],A.current.getCanvas().style.cursor="crosshair")}),A.current.on("mousemove",b=>{if(d&&a&&"box"===H.current){let c=[b.lngLat.lng,b.lngLat.lat],d=[[a[0],a[1]],[c[0],a[1]],[c[0],c[1]],[a[0],c[1]],[a[0],a[1]]];A.current.getSource("aoi-results").setData({type:"Feature",geometry:{type:"Polygon",coordinates:[d]},properties:{}})}}),A.current.on("mouseup",e=>{if(d&&a&&"box"===H.current){d=!1;let f=[e.lngLat.lng,e.lngLat.lat],g=[[a[0],a[1]],[f[0],a[1]],[f[0],f[1]],[a[0],f[1]],[a[0],a[1]]],i={type:"Feature",geometry:{type:"Polygon",coordinates:[g]},properties:{}};if(A.current.getSource("aoi-results").setData(i),b&&c){let a=h.W(i)/1e6;N(i),c(Math.round(100*a)/100,i)}A.current.getCanvas().style.cursor="",a=null}}),A.current.on("click",a=>{if(console.log("Click event fired, current tool:",H.current),"polygon"===H.current){console.log("Adding polygon vertex at:",a.lngLat);let b=[a.lngLat.lng,a.lngLat.lat];K.current.push(b),J([...K.current]);let c=A.current.getSource("polygon-temp");if(c)if(K.current.length>=2){let a={type:"Feature",geometry:{type:"LineString",coordinates:K.current},properties:{}};c.setData(a)}else c.setData({type:"FeatureCollection",features:[]});if(L.current.push([...K.current]),K.current.length>=3){let a=[...K.current,K.current[0]],b=A.current.getSource("aoi-results");b&&b.setData({type:"Feature",geometry:{type:"Polygon",coordinates:[a]},properties:{}})}}}),A.current.on("dblclick",a=>{if("polygon"===H.current&&K.current.length>=3){a.preventDefault();let d=[...K.current,K.current[0]],e={type:"Feature",geometry:{type:"Polygon",coordinates:[d]},properties:{}};if(A.current.getSource("aoi-results").setData(e),b&&c){let a=h.W(e)/1e6;N(e),c(Math.round(100*a)/100,e)}K.current=[],L.current=[],J([]),A.current.getCanvas().style.cursor=""}})}),A.current.on("error",a=>{console.error("MapLibre internal error:",a),(a.error?.message?.includes("webgl")||a.error?.message?.includes("Location"))&&E(!0)})}catch(a){console.warn("Map initialization failed, switching to Simulation Mode:",a.message),E(!0)}})(),()=>{A.current&&(A.current.remove(),A.current=null)}},[b]),(0,e.useEffect)(()=>{if(!b&&x&&A.current&&B){console.log("Loading initialGeoJSON:",x);let a=A.current.getSource("aoi-results");if(a){a.setData(x),N(x);try{let a=i.Q(x);A.current.fitBounds([a[0],a[1],a[2],a[3]],{padding:50,duration:1e3}),console.log("GeoJSON loaded and map fitted to bounds")}catch(a){console.error("Error fitting bounds:",a)}}else console.error("AOI source not found")}},[x,b,B]),(0,e.useImperativeHandle)(y,()=>({flyTo:(a,b,c)=>{A.current&&(c?A.current.fitBounds([c[0],c[1],c[2],c[3]],{padding:50,duration:1e3}):A.current.flyTo({center:[b,a],zoom:12,duration:1e3}),f&&f(a,b))},loadGeoJSON:a=>{let b;if(!A.current)return;let d=A.current.getSource("aoi-results");if(!d)return;if("FeatureCollection"===a.type){let c=a.features.find(a=>a.geometry&&["Polygon","MultiPolygon"].includes(a.geometry.type));if(!c)return;b=c}else b=a;d.setData(b),N(b);let e=h.W(b)/1e6;c&&c(Math.round(100*e)/100,b);let f=i.Q(b);A.current.fitBounds([f[0],f[1],f[2],f[3]],{padding:50,duration:1e3})},clearAOI:()=>{if(!A.current)return;let a=A.current.getSource("aoi-results");a&&a.setData({type:"FeatureCollection",features:[]}),N(null),J([]),c&&c(0)}})),D)?(0,d.jsx)("div",{className:`relative bg-slate-50 overflow-hidden ${a} flex items-center justify-center`,children:(0,d.jsxs)("div",{className:"max-w-md mx-auto text-center p-8 space-y-4",children:[(0,d.jsx)("div",{className:"w-16 h-16 bg-rose-100 rounded-full flex items-center justify-center mx-auto",children:(0,d.jsx)(j.A,{className:"w-8 h-8 text-rose-600"})}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("h3",{className:"text-lg font-bold text-slate-900",children:"Map Unavailable"}),(0,d.jsx)("p",{className:"text-sm text-slate-600 leading-relaxed",children:"Unable to initialize the interactive map. This may be due to WebGL not being supported or enabled in your browser."})]}),(0,d.jsxs)("div",{className:"bg-slate-100 rounded-lg p-4 text-left space-y-2",children:[(0,d.jsx)("p",{className:"text-xs font-bold text-slate-700",children:"Troubleshooting:"}),(0,d.jsxs)("ul",{className:"text-xs text-slate-600 space-y-1 list-disc list-inside",children:[(0,d.jsx)("li",{children:"Ensure WebGL is enabled in your browser settings"}),(0,d.jsx)("li",{children:"Update your graphics drivers"}),(0,d.jsx)("li",{children:"Try a different browser (Chrome, Firefox, or Edge)"}),(0,d.jsx)("li",{children:"Disable hardware acceleration and re-enable it"})]})]}),(0,d.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors",children:"Reload Page"})]})}):(0,d.jsxs)("div",{className:`relative bg-slate-50 overflow-hidden group ${a} flex items-center justify-center`,children:[!B&&(0,d.jsxs)("div",{className:"flex flex-col items-center gap-3 text-slate-400 z-20",children:[(0,d.jsx)(k.A,{className:"w-8 h-8 animate-spin"}),(0,d.jsx)("span",{className:"text-xs font-medium uppercase tracking-widest",children:"Loading Map Engine..."})]}),(0,d.jsx)("div",{ref:z,className:`absolute inset-0 w-full h-full transition-opacity duration-700 ${B?"opacity-100":"opacity-0"}`}),B&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"absolute right-4 top-4 space-y-2 z-10",children:[(0,d.jsxs)("div",{className:"bg-white/95 backdrop-blur rounded-lg border border-slate-200 shadow-lg overflow-hidden flex flex-col",children:[(0,d.jsx)("button",{onClick:()=>A.current?.zoomIn(),className:"p-2 hover:bg-slate-100 border-b border-slate-100",children:(0,d.jsx)(l.A,{className:"w-4 h-4 text-slate-600"})}),(0,d.jsx)("button",{onClick:()=>A.current?.zoomOut(),className:"p-2 hover:bg-slate-100",children:(0,d.jsx)(m.A,{className:"w-4 h-4 text-slate-600"})})]}),(0,d.jsx)("button",{onClick:()=>A.current?.resetNorthPitch(),className:"p-2 bg-white/95 backdrop-blur rounded-lg border border-slate-200 shadow-lg hover:bg-slate-100 transition-colors",children:(0,d.jsx)(n.A,{className:"w-4 h-4 text-slate-600"})}),(0,d.jsx)("button",{onClick:()=>{A.current&&(P(!0),"geolocation"in navigator?navigator.geolocation.getCurrentPosition(a=>{let{latitude:b,longitude:c}=a.coords;if(A.current){A.current.flyTo({center:[c,b],zoom:14,duration:1500});let a=new(g()).Marker({color:"#6366f1"}).setLngLat([c,b]).addTo(A.current);setTimeout(()=>a.remove(),3e3)}P(!1)},a=>{console.error("Geolocation error:",a),alert("Unable to get your location. Please check your browser permissions."),P(!1)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):(alert("Geolocation is not supported by your browser."),P(!1)))},disabled:O,className:"p-2 bg-white/95 backdrop-blur rounded-lg border border-slate-200 shadow-lg hover:bg-slate-100 transition-colors disabled:opacity-50",title:"Find My Location",children:O?(0,d.jsx)(k.A,{className:"w-4 h-4 text-indigo-600 animate-spin"}):(0,d.jsx)(o.A,{className:"w-4 h-4 text-slate-600"})})]}),(0,d.jsx)("div",{className:"absolute left-4 top-4 z-10",children:(0,d.jsxs)("div",{className:"bg-white/95 backdrop-blur rounded-lg border border-slate-200 shadow-lg flex flex-col p-1",children:[(0,d.jsx)("button",{onClick:()=>G("hand"),className:`p-2 rounded-md transition-colors ${"hand"===F?"bg-indigo-50 text-indigo-600":"hover:bg-slate-100 text-slate-600"}`,title:"Pan & Zoom",children:(0,d.jsx)(p.A,{className:"w-4 h-4"})}),b&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{onClick:()=>G("box"),className:`p-2 rounded-md transition-colors ${"box"===F?"bg-indigo-50 text-indigo-600":"hover:bg-slate-100 text-slate-600"}`,title:"Draw Rectangle",children:(0,d.jsx)(q.A,{className:"w-4 h-4"})}),(0,d.jsx)("button",{onClick:()=>G("polygon"),className:`p-2 rounded-md transition-colors ${"polygon"===F?"bg-indigo-50 text-indigo-600":"hover:bg-slate-100 text-slate-600"}`,title:"Draw Polygon",children:(0,d.jsx)(r.A,{className:"w-4 h-4"})}),I.length>0&&"polygon"===F&&(0,d.jsx)("button",{onClick:Q,className:"p-2 rounded-md hover:bg-amber-50 text-amber-600 transition-colors",title:"Undo Last Point (Ctrl+Z)",children:(0,d.jsx)(s.A,{className:"w-4 h-4"})}),(M||I.length>0)&&(0,d.jsx)("button",{onClick:()=>{let a=A.current?.getSource("aoi-results");a&&a.setData({type:"FeatureCollection",features:[]}),N(null),J([]),K.current=[],L.current=[],G("hand"),c&&c(0)},className:"p-2 rounded-md hover:bg-rose-50 text-rose-600 transition-colors border-t border-slate-200",title:"Clear AOI",children:(0,d.jsx)(t.A,{className:"w-4 h-4"})})]})]})}),(0,d.jsxs)("div",{className:"absolute bottom-4 left-4 right-4 flex justify-between items-end pointer-events-none z-10",children:[(0,d.jsxs)("div",{className:"bg-slate-900/85 backdrop-blur text-white px-3 py-1.5 rounded-lg text-[10px] font-medium pointer-events-auto flex items-center gap-2",children:[(0,d.jsx)(u.A,{className:"w-3 h-3 text-indigo-400"}),"MapLibre GL Engine | ESRI World Street Map"]}),(0,d.jsxs)("div",{className:"flex gap-2 pointer-events-auto",children:[(0,d.jsxs)("button",{className:"bg-white/95 backdrop-blur px-3 py-2 rounded-lg border border-slate-200 shadow-lg flex items-center gap-2 text-xs font-medium text-slate-700 hover:bg-slate-100",children:[(0,d.jsx)(v.A,{className:"w-4 h-4"})," Layers"]}),(0,d.jsx)("button",{className:"bg-white/95 backdrop-blur p-2 rounded-lg border border-slate-200 shadow-lg flex items-center justify-center hover:bg-slate-100",children:(0,d.jsx)(w.A,{className:"w-4 h-4 text-slate-600"})})]})]})]})]})})}};